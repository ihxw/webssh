# TermiScope 项目需求文

## 1. 项目概述

### 1.1 项目目标
创建一个基Web SSH 终端应用，允许用户通过浏览器访问和管理远程服务器，提供安全、便捷的远程终端访问体验

### 1.2 核心功能
- Web 终端模拟
- 用户账户管理系统
- SSH 连接信息管理
- 会话管理和历史记
- 多标签页终端支持

## 2. 技术栈

### 2.1 后端技
- **语言**: Golang
- **Web 框架**: Gin
- **数据**: SQLite (Go 实现)
- **WebSocket**: gorilla/websocket
- **SSH 客户**: golang.org/x/crypto/ssh
- **ORM**: GORM 

### 2.2 前端技
- **框架**: Vue 3 + Ant Design Vue (antdv)
- **终端组件**: xterm.js + xterm-addon-fit + xterm-addon-web-links
- **HTTP 客户**: Axios
- **状态管**: Pinia
- **路由**: Vue Router
- **构建工具**: Vite

### 2.3 UI/UX 设计原则
- 采用紧凑型布局，最大化终端显示区域
- 响应式设计，支持多种屏幕尺寸
- 暗色主题为主，护眼且专业
- 快捷键支持，提升操作效率

## 3. 功能需求详细说

### 3.1 用户认证与授

#### 3.1.1 用户注册
- 管理员可创建新用户账
- 必填字段：用户名、密码、邮
- 可选字段：显示名称、角色、备
- 密码强度验证（最8 位，包含字母和数字）

#### 3.1.2 用户登录
- 用户邮箱 + 密码登录
- JWT Token 认证机制
- 记住登录状态（可选）
- 登录失败次数限制（防暴力破解
- Session 超时自动登出

#### 3.1.3 权限管理
- 角色分类：管理员、普通用
- 管理员权限：
  - 用户管理（增删改查）
  - SSH 主机全局管理
  - 系统配置管理
  - 查看所有用户的连接历史
- 普通用户权限：
  - 管理自己SSH 主机信息
  - 建立 SSH 连接
  - 查看自己的连接历

### 3.2 SSH 主机管理

#### 3.2.1 主机信息录入
- 主机名称（自定义别名
- 主机地址（IP 或域名）
- SSH 端口（默22
- 认证方式
  - 密码认证
  - SSH 密钥认证
- 用户
- 密码/私钥内容
- 分组/标签（便于分类管理）
- 备注信息

#### 3.2.2 主机列表管理
- 列表展示所有已保存的主
- 搜索和筛选功
- 按分标签过滤
- 快速连接按
- 编辑和删除操
- 批量操作支持

#### 3.2.3 主机信息加密
- 敏感信息（密码、私钥）加密存储
- 使用 AES-256 加密算法
- 每个用户独立的加密密

### 3.3 Web 终端功能

#### 3.3.1 终端核心功能
- 完整的终端模拟（基于 xterm.js
- 支持 ANSI 颜色和格
- 可调整字体大
- 支持中文和其Unicode 字符
- 复制粘贴支持
- 终端大小自适应

#### 3.3.2 多标签页管理
- 同时打开多个 SSH 连接
- 标签页显示主机名
- 标签页拖拽排
- 快捷键切换标签页（Ctrl+Tab
- 关闭标签页确认提

#### 3.3.3 会话管理
- 保持连接状
- 断线自动重连（可配置
- 会话超时设置
- 手动断开连接
- 显示连接状态指示器

#### 3.3.4 高级功能
- 命令历史记录
- 文件上传/下载（SFTP
- 终端录制和回
- 快捷命令模板
- 终端分屏（可选）

### 3.4 连接历史记录

#### 3.4.1 历史记录内容
- 连接时间
- 目标主机信息
- 连接时长
- 用户操作
- 连接状态（成功/失败

#### 3.4.2 历史记录查询
- 按时间范围筛
- 按主机筛
- 按用户筛选（管理员）
- 导出历史记录

## 4. 数据库设

### 4.1 数据表结

#### 4.1.1 用户(users)
```sql
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    display_name VARCHAR(100),
    role VARCHAR(20) DEFAULT 'user', -- 'admin' or 'user'
    status VARCHAR(20) DEFAULT 'active', -- 'active', 'disabled'
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    last_login_at DATETIME
);
```

#### 4.1.2 SSH 主机(ssh_hosts)
```sql
CREATE TABLE ssh_hosts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    name VARCHAR(100) NOT NULL,
    host VARCHAR(255) NOT NULL,
    port INTEGER DEFAULT 22,
    username VARCHAR(100) NOT NULL,
    auth_type VARCHAR(20) NOT NULL, -- 'password' or 'key'
    password_encrypted TEXT, -- AES encrypted
    private_key_encrypted TEXT, -- AES encrypted
    group_name VARCHAR(50),
    tags VARCHAR(255),
    description TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);
```

#### 4.1.3 连接历史(connection_logs)
```sql
CREATE TABLE connection_logs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    ssh_host_id INTEGER,
    host VARCHAR(255) NOT NULL,
    port INTEGER NOT NULL,
    username VARCHAR(100) NOT NULL,
    status VARCHAR(20) NOT NULL, -- 'success', 'failed', 'disconnected'
    error_message TEXT,
    connected_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    disconnected_at DATETIME,
    duration INTEGER, -- seconds
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (ssh_host_id) REFERENCES ssh_hosts(id) ON DELETE SET NULL
);
```

#### 4.1.4 系统配置(system_config)
```sql
CREATE TABLE system_config (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    config_key VARCHAR(100) UNIQUE NOT NULL,
    config_value TEXT,
    description TEXT,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

## 5. API 接口设计

### 5.1 认证接口

#### POST /api/auth/login
- 描述：用户登
- 请求体：`{ "username": "string", "password": "string", "remember": boolean }`
- 响应：`{ "token": "string", "user": {...} }`

#### POST /api/auth/logout
- 描述：用户登
- 需要认证：

#### GET /api/auth/me
- 描述：获取当前用户信
- 需要认证：

### 5.2 用户管理接口（管理员

#### GET /api/users
- 描述：获取用户列
- 需要认证：是（管理员）
- 查询参数：`page`, `pageSize`, `search`

#### POST /api/users
- 描述：创建新用户
- 需要认证：是（管理员）

#### PUT /api/users/:id
- 描述：更新用户信
- 需要认证：是（管理员）

#### DELETE /api/users/:id
- 描述：删除用
- 需要认证：是（管理员）

### 5.3 SSH 主机管理接口

#### GET /api/ssh-hosts
- 描述：获SSH 主机列表
- 需要认证：
- 查询参数：`group`, `search`

#### POST /api/ssh-hosts
- 描述：添SSH 主机
- 需要认证：

#### PUT /api/ssh-hosts/:id
- 描述：更SSH 主机信息
- 需要认证：

#### DELETE /api/ssh-hosts/:id
- 描述：删SSH 主机
- 需要认证：

#### GET /api/ssh-hosts/:id
- 描述：获取单SSH 主机详情
- 需要认证：

### 5.4 SSH 连接接口

#### WebSocket /api/ws/ssh/:hostId
- 描述：建SSH WebSocket 连接
- 需要认证：
- 参数：hostId（SSH 主机 ID

#### POST /api/ssh/connect
- 描述：快速连接（不保存主机信息）
- 需要认证：
- 请求体：临时连接信息

### 5.5 连接历史接口

#### GET /api/connection-logs
- 描述：获取连接历史记
- 需要认证：
- 查询参数：`startDate`, `endDate`, `hostId`, `userId`（管理员

## 6. 前端页面结构

### 6.1 页面路由

```
/login                  - 登录页面
/dashboard              - 主控制台（布局容器
  /dashboard/terminal   - 终端页面（默认）
  /dashboard/hosts      - SSH 主机管理
  /dashboard/history    - 连接历史
  /dashboard/users      - 用户管理（管理员
  /dashboard/settings   - 系统设置
  /dashboard/profile    - 个人资料
```

### 6.2 页面布局

#### 6.2.1 主布局（紧凑型
```
+--------------------------------------------------+
| Header (高度: 48px)                               |
| [Logo] [导航菜单]              [用户] [退出]        |
+----------+---------------------------------------+
| Sider    | Content                               |
| (可折叠) |                                       |
| 宽度:     |                                       |
| 200px    |                                       |
|          |                                       |
| [菜单项]  |                                       |
+----------+---------------------------------------+
```

#### 6.2.2 终端页面布局
```
+--------------------------------------------------+
| [主机选择下拉] [新建连接] [标签] [标签] [+]   |
+--------------------------------------------------+
|                                                  |
|                                                  |
|              终端显示区域                          |
|              (xterm.js)                          |
|                                                  |
|                                                  |
+--------------------------------------------------+
| [状态栏] 连接状| 字符编码 | 终端大小             |
+--------------------------------------------------+
```

### 6.3 UI 组件规范

#### 6.3.1 颜色主题
- 主色调：#1890ff（Ant Design 蓝）
- 成功色：#52c41a
- 警告色：#faad14
- 错误色：#f5222d
- 背景色：#141414（暗色主题）
- 终端背景1e1e1e

#### 6.3.2 字体
- 界面字体apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto
- 终端字体Courier New', monospace, '微软雅黑'

## 7. 安全性要

### 7.1 认证安全
- 密码使用 bcrypt 哈希存储（cost=12
- JWT Token 有效期：24 小时
- Refresh Token 机制
- 登录失败 5 次锁定账15 分钟

### 7.2 数据安全
- SSH 密码和私钥使AES-256-GCM 加密
- HTTPS 强制使用（生产环境）
- WebSocket 使用 WSS 加密传输
- SQL 注入防护（使用参数化查询
- XSS 防护（输入验证和输出转义

### 7.3 SSH 连接安全
- 支持 SSH 密钥认证
- 主机密钥验证（可选）
- 连接超时设置
- 并发连接数限

### 7.4 审计日志
- 记录所有用户操
- 记录所SSH 连接
- 敏感操作告警

## 8. 性能要求

### 8.1 响应时间
- API 响应时间 < 200ms
- 页面加载时间 < 2s
- WebSocket 延迟 < 100ms

### 8.2 并发支持
- 支持至少 100 个并发用
- 单用户支持至10 个并SSH 连接

### 8.3 资源占用
- 单个 SSH 连接内存占用 < 10MB
- 数据库文件大小优化（定期清理历史记录

## 9. 部署要求

### 9.1 部署方式
- 单一可执行文件（嵌入前端静态文件）
- Docker 容器部署
- 支持 Linux、Windows、macOS

### 9.2 配置文件
```yaml
server:
  port: 8080
  mode: release # debug, release
  
database:
  path: ./data/TermiScope.db
  
security:
  jwt_secret: "your-secret-key"
  encryption_key: "your-encryption-key"
  
ssh:
  timeout: 30s
  max_connections_per_user: 10
  
log:
  level: info
  file: ./logs/app.log
```

### 9.3 环境变量
- `TermiScope_PORT`: 服务端口
- `TermiScope_DB_PATH`: 数据库路
- `TermiScope_JWT_SECRET`: JWT 密钥
- `TermiScope_ENCRYPTION_KEY`: 加密密钥

## 10. 开发计

### 10.1 第一阶段（核心功能）
- [ ] 项目初始化和基础架构搭建
- [ ] 用户认证系统
- [ ] SSH 主机管理
- [ ] 基础 Web 终端功能
- [ ] WebSocket SSH 连接

### 10.2 第二阶段（完善功能）
- [ ] 多标签页支持
- [ ] 连接历史记录
- [ ] 用户管理（管理员
- [ ] 系统配置管理

### 10.3 第三阶段（高级功能）
- [ ] SSH 密钥认证
- [ ] 文件上传/下载（SFTP
- [ ] 终端录制和回
- [ ] 快捷命令模板
- [ ] 性能优化和安全加

### 10.4 第四阶段（优化和发布
- [ ] 单元测试和集成测
- [ ] 文档编写
- [ ] Docker 镜像构建
- [ ] 生产环境部署指南

## 11. 测试要求

### 11.1 单元测试
- 后端核心逻辑覆盖> 80%
- 前端组件测试

### 11.2 集成测试
- API 接口测试
- WebSocket 连接测试
- SSH 连接测试

### 11.3 安全测试
- 渗透测
- 漏洞扫描
- 依赖安全检

## 12. 文档要求

### 12.1 用户文档
- 安装部署指南
- 使用手册
- 常见问题解答

### 12.2 开发文
- API 接口文档
- 数据库设计文
- 架构设计文档
- 代码规范

## 13. 后续扩展功能（可选）

- [ ] LDAP/AD 集成
- [ ] 双因素认证（2FA
- [ ] 会话共享和协
- [ ] 命令审计和回
- [ ] 批量命令执行
- [ ] 主机分组和权限控
- [ ] Kubernetes Pod 终端支持
- [ ] 国际化（i18n）支
- [ ] 移动端适配
